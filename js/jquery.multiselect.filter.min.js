(function(e){var t=/[\-\[\]{}()*+?.,\\\^$|#\s]/g;e.widget("ech.multiselectfilter",{options:{label:"Filter:",width:null,placeholder:"Enter keywords",autoReset:false},_create:function(){var t=this.options;var n=e(this.element);var r=this.instance=n.data("echMultiselect")||n.data("multiselect")||n.data("ech-multiselect");var i=this.header=r.menu.find(".ui-multiselect-header").addClass("ui-multiselect-hasfilter");var s=this.wrapper=e('<div class="ui-multiselect-filter">'+(t.label.length?t.label:"")+'<input placeholder="'+t.placeholder+'" type="search"'+(/\d/.test(t.width)?'style="width:'+t.width+'px"':"")+" /></div>").prependTo(this.header);this.inputs=r.menu.find('input[type="checkbox"], input[type="radio"]');this.input=s.find("input").bind({keydown:function(e){if(e.which===13){e.preventDefault()}},keyup:e.proxy(this._handler,this),click:e.proxy(this._handler,this)});this.updateCache();r._toggleChecked=function(t,n){var i=n&&n.length?n:this.labels.find("input");var s=this;var o=r._isOpen?":disabled, :hidden":":disabled";i=i.not(o).each(this._toggleState("checked",t));this.update();var u=i.map(function(){return this.value}).get();this.element.find("option").filter(function(){if(!this.disabled&&e.inArray(this.value,u)>-1){s._toggleState("selected",t).call(this)}});if(i.length){this.element.trigger("change")}};var o=e(document).bind("multiselectrefresh",e.proxy(function(){this.updateCache();this._handler()},this));if(this.options.autoReset){o.bind("multiselectclose",e.proxy(this._reset,this))}},_handler:function(n){var r=e.trim(this.input[0].value.toLowerCase()),i=this.rows,s=this.inputs,o=this.cache;if(!r){i.show()}else{i.hide();var u=new RegExp(r.replace(t,"\\$&"),"gi");this._trigger("filter",n,e.map(o,function(e,t){if(e.search(u)!==-1){i.eq(t).show();return s.get(t)}return null}))}this.instance.menu.find(".ui-multiselect-optgroup-label").each(function(){var t=e(this);var n=t.nextUntil(".ui-multiselect-optgroup-label").filter(function(){return e.css(this,"display")!=="none"}).length;t[n?"show":"hide"]()})},_reset:function(){this.input.val("").trigger("keyup")},updateCache:function(){this.rows=this.instance.menu.find(".ui-multiselect-checkboxes li:not(.ui-multiselect-optgroup-label)");this.cache=this.element.children().map(function(){var t=e(this);if(this.tagName.toLowerCase()==="optgroup"){t=t.children()}return t.map(function(){return this.innerHTML.toLowerCase()}).get()}).get()},widget:function(){return this.wrapper},destroy:function(){e.Widget.prototype.destroy.call(this);this.input.val("").trigger("keyup");this.wrapper.remove()}})})(jQuery)